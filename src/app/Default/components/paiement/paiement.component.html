<div class="body">

  <app-header></app-header>

  <div class="container my-5">
    <main>
      <div class="text-center mb-5">
        <h2 class="fw-bold">Formulaire de paiement</h2>
        <p class="lead text-muted">
          Merci pour votre confiance ! Veuillez vérifier les détails de votre commande avant de confirmer votre paiement.
        </p>
      </div>

      <div class="row g-4">
        <!-- Panier -->
        <div class="col-md-5 col-lg-4 order-md-last">
          <div class="card shadow-sm rounded p-4 h-100">
            <h4 class="d-flex justify-content-between align-items-center mb-3">
              <span class="text-primary">Votre Panier</span>
              <span class="badge bg-primary rounded-pill">{{ cartItems.length }}</span>
            </h4>
            <ul class="list-group mb-3">
              <li *ngFor="let item of cartItems" class="list-group-item d-flex justify-content-between align-items-center position-relative">
                <div>
                  <h6 class="my-0">{{ item.name }}</h6>
                  <small class="text-muted">{{ item.description }}</small>
                </div>
                <span class="text-muted">{{ item.prix }} DT</span>
                <button (click)="removeFromCart(item.id)" class="btn btn-outline-danger btn-sm position-absolute top-0 end-0 m-2">
                  ✖
                </button>
              </li>
              <li class="list-group-item d-flex justify-content-between fw-bold">
                <span>Total (DT)</span>
                <strong>{{ totalPrice }} DT</strong>
              </li>
            </ul>
          </div>
        </div>

        <!-- Formulaire Paiement -->
        <div class="col-md-7 col-lg-8">
          <div class="card shadow-sm rounded p-4 h-100">
            <form #paymentForm="ngForm" class="needs-validation" novalidate>

              <h4 class="mb-3">Mode de paiement</h4>
              <div class="mb-4">
                <div class="form-check">
                  <input id="credit" name="paymentMethod" type="radio" class="form-check-input" value="Visa" required>
                  <label class="form-check-label" for="credit">Visa</label>
                </div>
                <div class="form-check">
                  <input id="debit" name="paymentMethod" type="radio" class="form-check-input" value="MasterCard" required>
                  <label class="form-check-label" for="debit">MasterCard</label>
                </div>
                <div class="form-check">
                  <input id="paypal" name="paymentMethod" type="radio" class="form-check-input" value="PayPal" required>
                  <label class="form-check-label" for="paypal">PayPal</label>
                </div>
              </div>

              <div class="row g-3 mb-4">
                <div class="col-md-6">
                  <label for="cc-name" class="form-label">Nom sur la carte</label>
                  <input type="text" class="form-control" id="cc-name" name="ccName" [(ngModel)]="ccName" required #ccNameInput="ngModel">
                  <small class="text-muted">Nom complet tel qu'il apparaît sur la carte</small>
                  <div *ngIf="ccNameInput.invalid && ccNameInput.touched" class="text-danger small">
                    Le nom sur la carte est obligatoire.
                  </div>
                </div>

                <div class="col-md-6">
                  <label for="cc-number" class="form-label">Numéro de Carte de Crédit</label>
                  <input type="number" class="form-control" id="cc-number" name="ccNumber" [(ngModel)]="ccNumber" required pattern="^[0-9]+$" #ccNumberInput="ngModel">
                  <div *ngIf="ccNumberInput.invalid && ccNumberInput.touched" class="text-danger small">
                    Le numéro de carte de crédit est obligatoire.
                  </div>
                </div>

                <div class="col-md-3">
                  <label for="cc-expiration" class="form-label">Expiration</label>
                  <input type="date" class="form-control" id="cc-expiration" name="ccExpiration" [(ngModel)]="ccExpiration" required #ccExpirationInput="ngModel">
                  <div *ngIf="ccExpirationInput.invalid && ccExpirationInput.touched" class="text-danger small">
                    Date d'expiration requise
                  </div>
                </div>

                <div class="col-md-3">
                  <label for="cc-cvv" class="form-label">CVV</label>
                  <input type="number" class="form-control" id="cc-cvv" name="ccCvv" [(ngModel)]="ccCvv" required #ccCvvInput="ngModel">
                  <div *ngIf="ccCvvInput.invalid && ccCvvInput.touched" class="text-danger small">
                    Code de sécurité requis
                  </div>
                </div>
              </div>

              <button (click)="processPayment()" class="btn btn-primary w-100 btn-lg" type="button"
                      [disabled]="ccNameInput.invalid || ccNumberInput.invalid || ccExpirationInput.invalid || ccCvvInput.invalid">
                Confirmer le paiement
              </button>
            </form>
          </div>
        </div>
      </div>
    </main>

    <footer class="my-5 pt-5 text-muted text-center text-small">
      <p class="mb-1">&copy; 2001–2025 Computer Soft Service</p>
      <ul class="list-inline">
        <li class="list-inline-item"><a href="#">Privacy</a></li>
        <li class="list-inline-item"><a href="#">Terms</a></li>
        <li class="list-inline-item"><a href="#">Support</a></li>
      </ul>
    </footer>
  </div>

</div>

<style>
  .card {
    border-radius: 0.5rem;
  }
  .list-group-item {
    border-radius: 0.5rem;
    position: relative;
  }
  .remove-btn {
    top: 0.5rem;
    right: 0.5rem;
  }
  .form-control:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.2rem rgba(13,110,253,0.15);
  }
  .text-primary {
    color: #0d6efd !important;
  }
</style>
