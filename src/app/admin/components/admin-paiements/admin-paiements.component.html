<app-dashheader>

<div class="container mt-4">

  <!-- Summary Card -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div class="card shadow-sm p-3" style="min-width: 250px;">
      <h5 class="text-muted">Total Collected</h5>
      <h3 class="mb-0 fw-bold">{{ total }} TND</h3>
    </div>

    <button class="btn btn-danger" (click)="deleteAllPaiements()">
      <i class="bi bi-trash"></i> Delete All
    </button>
  </div>
  <!-- FILTRES ET ACTIONS -->
<div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3 mb-4">
  <div class="d-flex gap-2 flex-grow-1">
    <input 
      type="text" 
      class="form-control" 
      placeholder="Rechercher par nom ou email..."
      [(ngModel)]="searchTerm"
      (input)="onSearch()"
      style="max-width: 350px;">
    
    <button 
      class="btn btn-outline-primary d-flex align-items-center gap-2"
      (click)="toggleSort()">
      <i class="bi" 
         [class.bi-sort-numeric-down]="sortOrder === 'asc'"
         [class.bi-sort-numeric-up-alt]="sortOrder === 'desc'"
         [class.bi-arrow-down-up]="sortOrder === 'none'"></i>
      Trier par prix
    </button>
  </div>
  </div>
  <!-- Payments Table -->
  <div class="card shadow-sm">
    <div class="card-header bg-light fw-bold">Payments Dashboard</div>
    <div class="card-body p-0">

      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Email</th>
            <th>Solutions</th>
            <th>Paid</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let paiement of filteredPaiements; let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ paiement.userName }}</td>
            <td>{{ paiement.userEmail }}</td>
            <td>
              <span *ngFor="let solutionName of paiement.solutionNames" class="badge bg-info text-dark me-1">
                {{ solutionName }}
              </span>
            </td>
            <td>{{ paiement.totalPayed }} TND</td>
            <td>
              <button class="btn btn-sm btn-primary me-2" (click)="openReceiptModal(paiement)">
                Receipt
              </button>
              <button class="btn btn-sm btn-danger" (click)="deletePaiement(paiement.id)">
                Delete
              </button>
            </td>
          </tr>
      </tbody>

      </table>

    </div>
  </div>
</div>


<!-- Receipt Modal -->
<div class="modal fade" id="receiptModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow-lg border-0">

      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title"><i class="bi bi-receipt"></i> Payment Receipt</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body p-4">

        <h6 class="border-bottom pb-2">Client Information</h6>
        <p><strong>Name:</strong> {{ selectedPaiement?.userName }}</p>
        <p><strong>Email:</strong> {{ selectedPaiement?.userEmail }}</p>

        <h6 class="border-bottom pt-3 pb-2">Solutions Purchased</h6>
        <ul class="list-group">
          <li *ngFor="let solution of selectedPaiement?.solutionNames" 
              class="list-group-item d-flex justify-content-between">
            {{ solution }}
            <span class="text-muted">Included</span>
          </li>
        </ul>

        <h6 class="border-bottom pt-3 pb-2">Total Paid</h6>
        <h4 class="fw-bold text-success">{{ selectedPaiement?.totalPayed }} TND</h4>

      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>
</app-dashheader>